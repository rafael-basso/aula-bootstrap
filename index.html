<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebPage</title>
  <link rel="icon" href="/img/thumbs-up-solid.svg">
  <link rel="stylesheet" type="text/css" href="/bootstrap-5.1.3-dist/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="/public/css/style.css" />
  <!-- TOASTR -->
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/css/toastr.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/js/toastr.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-sm navbar-light">
    <a class="navbar-brand" href="https://www.dio.me/en" target="_blank">
      <img src="/img/logo-dio.svg" alt="imgTeste" height="80" />
    </a>
    <div class="navbar-collapse">
      <ul class="navbar-nav stack">
        <li class="nav-item">
          <a href="#who-we-are" class="nav-link" onmouseover="upperCase(this)" onmouseout="lowerCase(this)">Who am I</a>
        </li>
        <li class="nav-item">
          <a href="#partnerships" class="nav-link" onmouseover="upperCase(this)"
            onmouseout="lowerCase(this)">Interests</a>
        </li>
        <li class="nav-item">
          <a href="#services" class="nav-link" onmouseover="upperCase(this)" onmouseout="lowerCase(this)">Education</a>
        </li>
        <li class="nav-item">
          <a href="html/newTags.html" target="_blank" class="nav-link" id="new-Tag">Go to "HTML tags"</a>
        </li>
      </ul>
      <!-- Button trigger modal -->
      <button type="button" id="btn-close-send-message" class="btn btn-end rounded-circle btn-info btn-md"
        data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-backdrop="static" data-bs-keyboard="false">
        Contact me!
      </button>
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                Send your message to the HR department
              </h5>
              <button type="button" class="btn-close send-message-close" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body justify">
              <input id="inputEmail" type="text" placeholder="Type email here" style="font-size: 12pt;">
              <textarea id="msg" name="txt" cols="44.5" rows="8" placeholder="Type message here"></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary send-message-close" data-bs-dismiss="modal">
                Close
              </button>
              <button type="button" class="btn btn-primary toaster" id="liveAlertBtn">Send message</button>            
              <!-- loading image -->
              <div id="loading"></div>
              <!--Showing output-->
              <span id="loadingSpan">Sending...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <section id="who-we-are">
    <div class="container-fluid text-center who-we-are margin">
      <h1>About me</h1>
      <img src="/img/me.png" class="rounded-circle" height="250" width="250" />
    </div>
  </section>
  <section id="partnerships">
    <div class="container-fluid text-center partnerships margin">
      <h3 class="margin">INTERESTS</h3>
      <!-- carousel -->
      <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="/img/remoteWork.jpg" class="d-block w-100" alt="..." />
            <div class="carousel-caption d-md-block">
              <h5>Tech</h5>
              <p>Remote work</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="/img/code.jpg" class="d-block w-100" alt="..." />
            <div class="carousel-caption d-md-block">
              <h5>Tech</h5>
              <p>Coding</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="/img/workstation.jpg" class="d-block w-100" alt="..." />
            <div class="carousel-caption d-md-block">
              <h5>Tech</h5>
              <p>Workstation for developers</p>
            </div>
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
          data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
          data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
  </section>
  <section id="services">
    <div class="container-fluid text-center margin services">
      <h3 class="margin">EDUCATION</h3>
      <div class="container">
        <div class="row col-sm">

          <div class="col-lg-6">
            <p style="font-size: 13pt">
              Technician degree attended at:
            </p>
            <img src="/img/services.jpeg" usemap="#my-map1" />
            <map name="my-map1">
              <area shape="poly" coords="151,154,256,210,232,247,140,192" data-bs-toggle="collapse"
                href="#collapseExample1" aria-expanded="false" aria-controls="collapseExample">
            </map>
            <h3 style="margin-top: 10px; font-size: 15pt; font-style: italic; color: black; font-weight: bold;">Click on
              the phone to see the school's logo</h3>
            <!-- COLLAPSE -->
            <div class="collapse" id="collapseExample1">
              <div class="card card-body">
                <img src="/img/fatec.jpeg" alt="fatec" id="fatecImg">                
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <p style="font-size: 13pt">
              This is a description of extra courses taken
            </p>
            <img src="/img/services2.jpeg" usemap="#my-map" />
            <map name="my-map">
              <area shape="poly" coords="167,214,411,177,423,254,196,300" data-bs-toggle="collapse"
                href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
            </map>
            <h3 style="margin-top: 10px; font-size: 15pt; font-style: italic; color: black; font-weight: bold;">Click on
              "YES" for further information</h3>
            <!-- COLLAPSE -->
            <div class="collapse" id="collapseExample">
              <div class="card card-body">
                under construction                
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <footer class="container-fluid margin">
    <p style="font-style: italic">Developed by Rafael Basso&#174 - 2022</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous"></script>
  <script src="/public/js/app.js"></script>
  <script src="https://kit.fontawesome.com/5f73c2072d.js" crossorigin="anonymous"></script>
</body>

</html>

<style>
  body {
  font: 15pt Arial, sans-serif;
}

.navbar {
  background-color: rgb(112, 192, 145);
}

.margin {
  padding: 40px 40px;
}

.who-we-are {
  background-color: rgb(220, 230, 226);
  }

.partnerships {
  /* padding: 40px 40px; */
  background-color: rgb(231, 241, 238);
}

.services {
  background-color: whitesmoke;
}

.carousel-inner img {
  height: 75vh;
}

#collapseExample1 {
  margin: 0 5rem 0 5rem;
}

#btn-close-send-message {  
  position: fixed;
  z-index: 9999;
  right: 40px;
  bottom: 30px;  
  background-color: rgb(179, 179, 233);
  border: 2px solid rgb(112, 192, 145);  
  color: black;
  text-align: center;
  width: 7%;
  height: 15%;  
  font-size: 15px;
}

#btn-close-send-message:hover {
  background-color: rgb(148, 151, 150);
}

.justify input{
  width: 100%;  
}

.justify textarea {
  margin-top: 15px; 
  width: 100%;
}

.navbar-collapse #new-Tag {
  position: absolute;
  right: 50px;
}

/* LOADING IMAGE */
#loading {
  width: 3rem;
  height: 3rem;
  border: 5px solid #f3f3f3;
  border-top: 6px solid #545157;
  border-radius: 100%;
  margin: auto;  
  visibility: hidden;
  animation: spin 1s infinite linear;
}
#loadingSpan {
  margin-right: 50px;
  visibility: hidden;
}
#loading.display {
  visibility: visible;
}
#loadingSpan.display {
  visibility: visible;
}

@keyframes spin {
  from {
      transform: rotate(0deg);
  }
  to {
      transform: rotate(360deg);
  }
}


/* RESPONSIVE */

@media screen and (max-width: 1024px) {   
  .stack {
    font-size: medium;
    display: grid;
    margin-left: 30px;
    font-weight: bold;
  }

  #btn-close-send-message {
    font-size: 15px;
    width: 20vw;
    height: 7vh;
  } 
  
  .container div > img {
    width: inherit;
  }
}

</style>

<script>
  const express = require("express");
const app = express();
const nodemailer = require("nodemailer");
const path = require("path");

//MIDDLEWARE
app.use(express.static(path.join(__dirname, "/public")));
app.use(express.static(__dirname));

app.use(express.json());

app.get("/", (req, res) => {
    res.sendFile(__dirname + "/public/index.html");
});

app.post("/", (req, res) => {
    console.log(req.body);

    var transport = nodemailer.createTransport({
        host: "smtp.gmail.com",
        port: 587,
        //secure: false,
        auth: {
            user: "testem834@gmail.com",            
            pass: "cghjvlixemobojbt",            
        },
        tls: {
            rejectUnauthorized: false,
        }
    });

    transport
        .sendMail({
            from: req.body.inputEmail,
            to: "testem834@gmail.com",
            //replyTo: "<mail>" // email de terceiro
            subject: `Message from ${req.body.inputEmail}`,
            text: req.body.msg,
            //html: '<p>text for test</p>'
        })
        .then((info) => {
            res.send(info);
        })
        .catch((e) => {
            res.send(e);
        });
});

app.listen(8080, () => {
    console.log("Server running on port 8080");
});

  $(function () {
    $("#btn-close-send-message").on("click", function () {
        $("#btn-close-send-message").hide("slow");
    });

    $(".send-message-close").on("click", function () {
        $("#btn-close-send-message").show("slow");
        $("#msg").val("");
        $("#inputEmail").val("");
    });

    $(".toaster").on("click", function () {
        const loader = document.querySelector("#loading");
        const loaderSpan = document.querySelector("#loadingSpan");

        function displayLoading() {
            loader.classList.add("display");
            loaderSpan.classList.add("display");
        }

        function hideLoading() {
            loader.classList.remove("display");
            loaderSpan.classList.remove("display");
        }

        toastr.options.positionClass = "toast-bottom-right";
        let inputEmail = $("#inputEmail").val();
        let msg = $("#msg").val();
        var validEmail = validateEmail(inputEmail);

        if (msg == "" || inputEmail == "") {
            toastr.clear();
            toastr.error("Please type your email and message");
        } else if (validEmail == false) {
            toastr.clear();
            toastr.error("Please type a valid email address");
        } else {
            let data = {
                inputEmail: inputEmail,
                msg: msg,
            };

            let xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function () {
                if (this.readyState !== 4 && this.status !== 200) {
                    displayLoading();
                }
            };

            xhr.open("POST", "/");
            xhr.setRequestHeader("content-type", "application/json");
            xhr.onload = function () {
                if (xhr.responseText) {
                    console.log(xhr.responseText);
                    hideLoading();
                    toastr.clear();
                    toastr.success("Email sent successfully!");
                    $("#msg").val("");
                    $("#inputEmail").val("");
                } else {
                    toastr.clear();
                    toastr.error("Bad response! Please try again later.");
                    hideLoading();
                }
            };
            xhr.send(JSON.stringify(data));
        }
    });
});

function upperCase(element) {
    element.style.fontSize = "25px";
}

function lowerCase(element) {
    element.style.fontSize = "20px";
}

function validateEmail(email) {
    var re = new RegExp(
        /^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i
    );
    return re.test(email);
}

</script>